

const http = require('http');
const express=require("express");
const router=express.Router();
var jwt = require('jsonwebtoken');
const User=require("./models/User");



router.use(function (req, res, next) {
        res.setHeader('Access-Control-Allow-Origin', '*');
        res.setHeader('Access-Control-Allow-Headers',"X-PINGOTHER, Content-Type, authorization");
        res.setHeader('Access-Control-Allow-Methods',"POST, GET, DELETE");
        next();
      });
   
router.post("/",(req,res)=>{
    var data=req.body;
 

    User.find(data,(error,response)=>{
        if(error){
            res.status(500);
            res.send(error);
            return;
        }
        // console.log(response);
        if(response.length){
            var token=jwt.sign({userid:User._id},"shhhh");
            res.send(token);
        }
        else{
            res.send("user not found")
        }
        })
    });
    router.get("/", (req, res) => {

        var token=req.headers['authorization'];
        // if(token===undefined){
        //     res.status(401);
            
        // }
        // else{
        var query = {
          username:'Maheen'
        }
        try {
            var decoded = jwt.verify(token, 'shhhh');
            User.find(query,(error,response)=>{
               if(error){
                   res.status(500);
                   res.send(error);
                   return
               }
            
           res.send(response);
            })
           
          } 
        catch(err) {
            res.status(401).send(err);
          }
        
    });
    router.delete("/",(req,res)=>{

        var token=req.headers['authorization'];
        console.log(token);
        try {
            var decoded = jwt.verify(token, 'shhhh');
            console.log(decoded);
            res.send("TOKEN DELETED");
          } 
        catch(err) {
            res.send(err);
          } 
    })

  module.exports=router;